<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:FrapaClonia.UI.ViewModels;assembly=FrapaClonia.UI"
             xmlns:converters="clr-namespace:FrapaClonia.UI.Converters;assembly=FrapaClonia.UI"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="600"
             x:Class="FrapaClonia.UI.Views.SettingsView"
             x:DataType="vm:SettingsViewModel">

  <Design.DataContext>
    <vm:SettingsViewModel />
  </Design.DataContext>

  <UserControl.Resources>
    <converters:CountToEmptyVisibilityConverter x:Key="CountToEmptyVisibilityConverter" />
    <converters:BoolToInUseStringConverter x:Key="BoolToInUseStringConverter" />
  </UserControl.Resources>

  <UserControl.Styles>
    <StyleInclude Source="avares://FrapaClonia.UI/Styles/SharedStyles.axaml" />
  </UserControl.Styles>

  <ScrollViewer HorizontalScrollBarVisibility="Disabled">
    <Panel Margin="{StaticResource ContentPadding}">
      <StackPanel Spacing="{StaticResource SpacingL}">
        <!-- Header -->
        <TextBlock Text="{DynamicResource Localized_Settings}"
                   FontSize="{StaticResource FontSizeXXXL}"
                   FontWeight="{StaticResource FontWeightSemiBold}"
                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}" />

        <!-- Language Settings -->
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <TextBlock Text="{DynamicResource Localized_LanguageAndRegion}"
                       Classes="section-title"
                       Margin="{StaticResource ThicknessBottomM}" />

            <Grid ColumnDefinitions="180,*" RowDefinitions="Auto">
              <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{DynamicResource Localized_InterfaceLanguage}"
                           Classes="field-label" />
                <Button Classes="hint-icon">
                  <ToolTip.Tip>
                    <TextBlock Text="{DynamicResource Localized_ChangesWillTakeEffectImmediately}" />
                  </ToolTip.Tip>
                </Button>
              </StackPanel>
              <ComboBox Grid.Row="0" Grid.Column="1"
                        ItemsSource="{Binding AvailableLanguages}"
                        SelectedItem="{Binding SelectedLanguage}"
                        Classes="settings-dropdown"
                        AutomationProperties.Name="Interface Language">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Name}" />
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Startup Settings -->
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <TextBlock Text="{DynamicResource Localized_SystemIntegration}"
                       Classes="section-title"
                       Margin="{StaticResource ThicknessBottomM}" />

            <CheckBox IsChecked="{Binding AutoStartEnabled}"
                      Classes="settings-checkbox"
                      AutomationProperties.Name="Start on system boot">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{DynamicResource Localized_StartOnSystemBoot}"
                           FontSize="{StaticResource FontSizeM}"
                           FontWeight="{StaticResource FontWeightMedium}"
                           VerticalAlignment="Center" />
                <Button Classes="hint-icon">
                  <ToolTip.Tip>
                    <TextBlock Text="{DynamicResource Localized_AutomaticallyLaunchFrapaClonia}" />
                  </ToolTip.Tip>
                </Button>
              </StackPanel>
            </CheckBox>
          </StackPanel>
        </Border>

        <!-- Appearance Settings -->
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <TextBlock Text="{DynamicResource Localized_Appearance}"
                       Classes="section-title"
                       Margin="{StaticResource ThicknessBottomM}" />

            <Grid ColumnDefinitions="180,*" RowDefinitions="Auto">
              <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{DynamicResource Localized_Theme}"
                           Classes="field-label" />
                <Button Classes="hint-icon">
                  <ToolTip.Tip>
                    <TextBlock Text="{DynamicResource Localized_ChooseYourPreferredColorTheme}" />
                  </ToolTip.Tip>
                </Button>
              </StackPanel>
              <ComboBox Grid.Row="0" Grid.Column="1"
                        ItemsSource="{Binding AvailableThemes}"
                        SelectedIndex="{Binding ThemeIndex}"
                        Classes="settings-dropdown"
                        AutomationProperties.Name="Theme">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding Name}" />
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>
            </Grid>
          </StackPanel>
        </Border>

        <!-- Application Mode -->
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <TextBlock Text="{DynamicResource Localized_ApplicationMode}"
                       Classes="section-title"
                       Margin="{StaticResource ThicknessBottomM}" />

            <CheckBox IsChecked="{Binding PortableMode}"
                      IsEnabled="False"
                      Classes="settings-checkbox"
                      AutomationProperties.Name="Portable Mode">
              <StackPanel Orientation="Horizontal" Spacing="4">
                <TextBlock Text="{DynamicResource Localized_PortableMode}"
                           FontSize="{StaticResource FontSizeM}"
                           FontWeight="{StaticResource FontWeightMedium}"
                           VerticalAlignment="Center" />
                <Button Classes="hint-icon">
                  <ToolTip.Tip>
                    <TextBlock Text="{DynamicResource Localized_ConfigurationStoredInAppDir}" />
                  </ToolTip.Tip>
                </Button>
              </StackPanel>
            </CheckBox>

            <Border BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                    BorderThickness="0,1,0,0"
                    Margin="{StaticResource ThicknessTopL}"
                    Padding="{StaticResource ThicknessTopL}">
              <StackPanel Spacing="0">
                <TextBlock Text="{DynamicResource Localized_ConfigurationLocation}"
                           Classes="field-label" />
                <TextBlock Text="{Binding ConfigLocation}"
                           Classes="readonly-value"
                           AutomationProperties.Name="Configuration Location" />
              </StackPanel>
            </Border>
          </StackPanel>
        </Border>

        <!-- Frpc Version Management -->
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <Grid ColumnDefinitions="*,Auto" Margin="{StaticResource ThicknessBottomM}">
              <TextBlock Grid.Column="0"
                         Text="{DynamicResource Localized_FrpcVersions}"
                         Classes="section-title"
                         VerticalAlignment="Center" />
              <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                <Button Command="{Binding RefreshVersionsCommand}"
                        Classes="action-button"
                        IsEnabled="{Binding !IsLoadingVersions}">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="{DynamicResource Localized_Refresh}" />
                  </StackPanel>
                </Button>
                <Button Command="{Binding DeleteVersionCommand}"
                        Classes="action-button">
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <TextBlock Text="{DynamicResource Localized_Delete}" />
                  </StackPanel>
                </Button>
              </StackPanel>
            </Grid>

            <!-- Version list -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    CornerRadius="6"
                    Padding="0"
                    MinHeight="120">
              <Grid RowDefinitions="Auto,*">
                <!-- Header -->
                <Border Grid.Row="0"
                        Background="{DynamicResource SystemControlBackgroundChromeMediumBrush}"
                        CornerRadius="6,6,0,0"
                        Padding="12,8">
                  <Grid ColumnDefinitions="*,120,100,80">
                    <TextBlock Grid.Column="0" Text="{DynamicResource Localized_Version}"
                               FontWeight="{StaticResource FontWeightSemiBold}"
                               FontSize="{StaticResource FontSizeS}" />
                    <TextBlock Grid.Column="1" Text="{DynamicResource Localized_Platform}"
                               FontWeight="{StaticResource FontWeightSemiBold}"
                               FontSize="{StaticResource FontSizeS}" />
                    <TextBlock Grid.Column="2" Text="{DynamicResource Localized_Architecture}"
                               FontWeight="{StaticResource FontWeightSemiBold}"
                               FontSize="{StaticResource FontSizeS}" />
                    <TextBlock Grid.Column="3" Text="{DynamicResource Localized_Status}"
                               FontWeight="{StaticResource FontWeightSemiBold}"
                               FontSize="{StaticResource FontSizeS}"
                               TextAlignment="Center" />
                  </Grid>
                </Border>

                <!-- Loading indicator -->
                <StackPanel Grid.Row="1"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="8"
                            IsVisible="{Binding IsLoadingVersions}">
                  <ProgressBar IsIndeterminate="True" Width="100" />
                  <TextBlock Text="{DynamicResource Localized_LoadingVersions}"
                             FontSize="{StaticResource FontSizeS}"
                             Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                </StackPanel>

                <!-- Empty state -->
                <StackPanel Grid.Row="1"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="8">
                  <StackPanel.IsVisible>
                    <MultiBinding Converter="{x:Static BoolConverters.And}">
                      <Binding Path="!IsLoadingVersions" />
                      <Binding Path="DownloadedVersions.Count" Converter="{StaticResource CountToEmptyVisibilityConverter}" />
                    </MultiBinding>
                  </StackPanel.IsVisible>
                  <TextBlock Text="{DynamicResource Localized_NoVersionsDownloaded}"
                             FontSize="{StaticResource FontSizeS}"
                             Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
                </StackPanel>

                <!-- Version list -->
                <ScrollViewer Grid.Row="1"
                              MaxHeight="200"
                              IsVisible="{Binding !IsLoadingVersions}">
                  <ItemsControl ItemsSource="{Binding DownloadedVersions}">
                    <ItemsControl.ItemTemplate>
                      <DataTemplate>
                        <Border Background="Transparent"
                                Padding="12,8"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                BorderThickness="0,0,0,1">
                          <Border.Styles>
                            <Style Selector="Border:pointerover /template/ ContentPresenter">
                              <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundListLowBrush}" />
                            </Style>
                          </Border.Styles>
                          <Grid ColumnDefinitions="*,120,100,80">
                            <TextBlock Grid.Column="0"
                                       Text="{Binding Version}"
                                       VerticalAlignment="Center"
                                       FontSize="{StaticResource FontSizeS}" />
                            <TextBlock Grid.Column="1"
                                       Text="{Binding Platform}"
                                       VerticalAlignment="Center"
                                       FontSize="{StaticResource FontSizeS}" />
                            <TextBlock Grid.Column="2"
                                       Text="{Binding Architecture}"
                                       VerticalAlignment="Center"
                                       FontSize="{StaticResource FontSizeS}" />
                            <TextBlock Grid.Column="3"
                                       Text="{Binding IsInUse, Converter={StaticResource BoolToInUseStringConverter}}"
                                       VerticalAlignment="Center"
                                       FontSize="{StaticResource FontSizeS}"
                                       TextAlignment="Center" />
                          </Grid>
                        </Border>
                      </DataTemplate>
                    </ItemsControl.ItemTemplate>
                  </ItemsControl>
                </ScrollViewer>
              </Grid>
            </Border>

            <!-- Info text -->
            <TextBlock Text="{DynamicResource Localized_VersionManagementHint}"
                       FontSize="{StaticResource FontSizeS}"
                       Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                       TextWrapping="Wrap"
                       Margin="{StaticResource ThicknessTopS}" />
          </StackPanel>
        </Border>

        <!-- About Information -->
        <!-- 
        <Border Classes="settings-card">
          <StackPanel Spacing="0">
            <TextBlock Text="{DynamicResource Localized_About}"
                       Classes="section-title"
                       Margin="{StaticResource ThicknessBottomM}" />

            <Grid ColumnDefinitions="120,Auto" RowDefinitions="Auto,Auto,Auto,Auto">
              <TextBlock Grid.Row="0" Grid.Column="0"
                         Text="{DynamicResource Localized_VersionInfo}"
                         Classes="field-label" />
              <TextBlock Grid.Row="0" Grid.Column="1"
                         Text="0.1.0"
                         VerticalAlignment="Center" />

              <TextBlock Grid.Row="1" Grid.Column="0"
                         Text="{DynamicResource Localized_BuildInfo}"
                         Classes="field-label" />
              <TextBlock Grid.Row="1" Grid.Column="1"
                         Text="Development"
                         VerticalAlignment="Center" />

              <TextBlock Grid.Row="2" Grid.Column="0"
                         Text="{DynamicResource Localized_NetRuntimeInfo}"
                         Classes="field-label" />
              <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="4">
                <TextBlock Text="10.0"
                           VerticalAlignment="Center" />
                <Button Classes="hint-icon">
                  <ToolTip.Tip>
                    <TextBlock Text="{DynamicResource Localized_CrossPlatformFrpcVisualClient}" />
                  </ToolTip.Tip>
                </Button>
              </StackPanel>
            </Grid>
          </StackPanel>
        </Border> -->

        <!-- Action Buttons -->
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="{StaticResource SpacingM}"
                    Margin="{StaticResource ThicknessTopS}">
          <Button Command="{Binding ResetCommand}"
                  Content="{DynamicResource Localized_ResetToDefaults}"
                  Classes="action-button"
                  IsEnabled="{Binding !IsSaving}"
                  AutomationProperties.Name="Reset to Defaults" />

          <Button Command="{Binding SaveCommand}"
                  Classes="action-button primary"
                  IsEnabled="{Binding !IsSaving}"
                  AutomationProperties.Name="Save Settings">
            <StackPanel Orientation="Horizontal" Spacing="6">
              <TextBlock Text="{DynamicResource Localized_SaveSettings}" />
              <ProgressBar IsIndeterminate="True"
                           Width="16"
                           Height="16"
                           IsVisible="{Binding IsSaving}" />
            </StackPanel>
          </Button>
        </StackPanel>
      </StackPanel>
    </Panel>
  </ScrollViewer>
</UserControl>