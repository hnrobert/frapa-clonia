<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:FrapaClonia.UI.ViewModels;assembly=FrapaClonia.UI"
             xmlns:mi="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:converters="clr-namespace:FrapaClonia.UI.Converters;assembly=FrapaClonia.UI"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="600"
             x:Class="FrapaClonia.UI.Views.DeploymentView"
             x:DataType="vm:DeploymentViewModel">

  <Design.DataContext>
    <vm:DeploymentViewModel />
  </Design.DataContext>

  <UserControl.Resources>
    <converters:BoolToAvailableStringConverter x:Key="BoolToAvailableStringConverter" />
    <converters:BoolToDeployedStringConverter x:Key="BoolToDeployedStringConverter" />
  </UserControl.Resources>

  <UserControl.Styles>
    <StyleInclude Source="avares://FrapaClonia.UI/Styles/SharedStyles.axaml" />
  </UserControl.Styles>

  <ScrollViewer HorizontalScrollBarVisibility="Disabled">
    <Panel Margin="{StaticResource ContentPadding}">
      <StackPanel Spacing="{StaticResource SpacingL}">
        <!-- Header -->
        <TextBlock Text="{DynamicResource Localized_Deployment}"
                   Classes="page-title" />

        <!-- Deployment Mode Selection -->
        <Border Classes="settings-card">
          <StackPanel Spacing="{StaticResource SpacingM}">
            <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
              <TextBlock Text="{DynamicResource Localized_DeploymentMode}"
                         Classes="section-title"
                         VerticalAlignment="Center" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
              <ComboBox ItemsSource="{Binding DeploymentModes}"
                        SelectedItem="{Binding SelectedDeploymentMode}"
                        MinWidth="200"
                        HorizontalAlignment="Left">
                <ComboBox.ItemTemplate>
                  <DataTemplate>
                    <TextBlock Text="{Binding}" />
                  </DataTemplate>
                </ComboBox.ItemTemplate>
              </ComboBox>

              <Button Classes="hint-icon"
                      VerticalAlignment="Center">
                <ToolTip.Tip>
                  <TextBlock Text="{DynamicResource Localized_ChooseHowYouWantToDeployAndRunFrpc}" />
                </ToolTip.Tip>
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Docker Deployment -->
        <Border Classes="settings-card">
          <StackPanel Spacing="{StaticResource SpacingM}">
            <TextBlock Text="{DynamicResource Localized_DockerDeployment}"
                       Classes="section-title" />

            <Grid ColumnDefinitions="180,*" RowDefinitions="Auto,Auto">
              <TextBlock Grid.Row="0" Grid.Column="0"
                         Text="{DynamicResource Localized_DockerStatus}"
                         Classes="field-label" />
              <StackPanel Grid.Row="0" Grid.Column="1"
                          Orientation="Horizontal"
                          Spacing="{StaticResource SpacingM}">
                <TextBlock
                  Text="{Binding IsDockerAvailable, Converter={StaticResource BoolToAvailableStringConverter}}"
                  VerticalAlignment="Center" />
                <Button Command="{Binding CheckDockerCommand}"
                        Content="{DynamicResource Localized_CheckDocker}"
                        IsEnabled="{Binding !IsDockerChecking}"
                        Classes="action-button" />
              </StackPanel>

              <TextBlock Grid.Row="1" Grid.Column="0"
                         Text="{DynamicResource Localized_ContainerName}"
                         Classes="field-label" />
              <TextBox Grid.Row="1" Grid.Column="1"
                       Text="{Binding DockerContainerName}"
                       Watermark="frapa-clonia-frpc"
                       MinWidth="200" />
            </Grid>

            <TextBlock Text="{DynamicResource Localized_DockerImage}"
                       Classes="field-label"
                       Margin="{StaticResource ThicknessTopS}" />
            <TextBox Text="{Binding DockerImageName}"
                     Watermark="fatedier/frpc:latest" />

            <TextBlock Text="{DynamicResource Localized_DockerComposePath}"
                       Classes="field-label"
                       Margin="{StaticResource ThicknessTopS}" />
            <TextBox Text="{Binding DockerComposePath}"
                     IsReadOnly="True"
                     Watermark="Not generated yet" />

            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource SpacingM}"
                        Margin="{StaticResource ThicknessTopS}">
              <Button Command="{Binding GenerateDockerComposeCommand}"
                      Classes="action-button icon-text-button">
                <StackPanel>
                  <mi:MaterialIcon Kind="FileDocument" />
                  <TextBlock Text="{DynamicResource Localized_GenerateDockerComposeYml}" />
                </StackPanel>
              </Button>
              <Button Command="{Binding StartDockerCommand}"
                      Classes="action-button primary icon-text-button">
                <StackPanel>
                  <mi:MaterialIcon Kind="Play" />
                  <TextBlock Text="{DynamicResource Localized_StartContainer}" />
                </StackPanel>
              </Button>
              <Button Command="{Binding StopDockerCommand}"
                      Classes="action-button destructive icon-text-button">
                <StackPanel>
                  <mi:MaterialIcon Kind="Stop" />
                  <TextBlock Text="{DynamicResource Localized_StopContainer}" />
                </StackPanel>
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Native Deployment -->
        <Border Classes="settings-card">
          <StackPanel Spacing="{StaticResource SpacingM}">
            <TextBlock Text="{DynamicResource Localized_NativeDeployment}"
                       Classes="section-title" />

            <Grid ColumnDefinitions="180,*" RowDefinitions="Auto,Auto">
              <TextBlock Grid.Row="0" Grid.Column="0"
                         Text="{DynamicResource Localized_DeploymentStatus}"
                         Classes="field-label" />
              <StackPanel Grid.Row="0" Grid.Column="1"
                          Orientation="Horizontal"
                          Spacing="{StaticResource SpacingM}">
                <TextBlock
                  Text="{Binding IsNativeDeployed, Converter={StaticResource BoolToDeployedStringConverter}}"
                  VerticalAlignment="Center" />
                <Button Command="{Binding CheckNativeCommand}"
                        IsEnabled="{Binding !IsNativeChecking}"
                        Classes="action-button icon-text-button">
                  <StackPanel>
                    <mi:MaterialIcon Kind="Check" />
                    <TextBlock Text="{DynamicResource Localized_CheckDeployment}" />
                  </StackPanel>
                </Button>
              </StackPanel>

              <TextBlock Grid.Row="1" Grid.Column="0"
                         Text="{DynamicResource Localized_BinaryPath}"
                         Classes="field-label" />
              <TextBlock Grid.Row="1" Grid.Column="1"
                         Text="{Binding DeployedBinaryPath}"
                         FontFamily="{DynamicResource MonoFontFamily}"
                         Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                         TextWrapping="Wrap"
                         VerticalAlignment="Center" />
            </Grid>

            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource SpacingM}"
                        Margin="{StaticResource ThicknessTopS}">
              <Button Command="{Binding DownloadFrpcCommand}"
                      Classes="action-button icon-text-button">
                <StackPanel>
                  <mi:MaterialIcon Kind="Download" />
                  <TextBlock Text="{DynamicResource Localized_DownloadFrpc}" />
                </StackPanel>
              </Button>
              <Button Command="{Binding DeployNativeCommand}"
                      Classes="action-button primary icon-text-button">
                <StackPanel>
                  <mi:MaterialIcon Kind="RocketLaunch" />
                  <TextBlock Text="{DynamicResource Localized_DeployNative}" />
                </StackPanel>
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>

        <!-- Information -->
        <Border Classes="settings-card">
          <StackPanel Spacing="{StaticResource SpacingS}">
            <StackPanel Orientation="Horizontal" Spacing="4">
              <TextBlock Text="{DynamicResource Localized_DeploymentInformation}"
                         Classes="section-title" />
              <Button Classes="icon-button">
                <ToolTip.Tip>
                  <StackPanel>
                    <TextBlock Text="{DynamicResource Localized_DockerDeploymentRequiresDocker}" />
                    <TextBlock
                      Text="{DynamicResource Localized_NativeDeploymentDownloadsAndExtracts}" />
                    <TextBlock Text="{DynamicResource Localized_BothMethodsUse}" />
                  </StackPanel>
                </ToolTip.Tip>
              </Button>
            </StackPanel>
          </StackPanel>
        </Border>
      </StackPanel>
    </Panel>
  </ScrollViewer>
</UserControl>

