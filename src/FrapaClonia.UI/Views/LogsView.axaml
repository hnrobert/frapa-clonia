<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:FrapaClonia.UI.ViewModels;assembly=FrapaClonia.UI"
             xmlns:converters="clr-namespace:FrapaClonia.UI.Converters;assembly=FrapaClonia.UI"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
             x:Class="FrapaClonia.UI.Views.LogsView"
             x:DataType="vm:LogsViewModel">

    <Design.DataContext>
        <vm:LogsViewModel />
    </Design.DataContext>

    <UserControl.Resources>
        <converters:LevelToLowerConverter x:Key="LevelToLowerConverter" />
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="ListBox.logViewer">
            <Setter Property="FontFamily" Value="{DynamicResource MonoFontFamily}" />
            <Setter Property="FontSize" Value="{StaticResource FontSizeS}" />
            <Setter Property="Background" Value="{DynamicResource SystemControlBackgroundBaseLowBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="BorderBrush" Value="{DynamicResource SystemControlForegroundBaseLowBrush}" />
            <Setter Property="Padding" Value="{StaticResource ThicknessS}" />
        </Style>

        <Style Selector="ListBox.logViewer > ListBoxItem">
            <Setter Property="Padding" Value="4,2" />
            <Setter Property="BorderThickness" Value="0" />
        </Style>

        <Style Selector="ListBoxItem.log-debug">
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseMediumBrush}" />
        </Style>

        <Style Selector="ListBoxItem.log-info">
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseHighBrush}" />
        </Style>

        <Style Selector="ListBoxItem.log-warning">
            <Setter Property="Foreground" Value="{DynamicResource AppAccentColor3Brush}" />
        </Style>

        <Style Selector="ListBoxItem.log-error">
            <Setter Property="Foreground" Value="{DynamicResource AppErrorBrush}" />
            <Setter Property="FontWeight" Value="{StaticResource FontWeightSemiBold}" />
        </Style>

        <Style Selector="TextBlock.log-timestamp">
            <Setter Property="Foreground" Value="{DynamicResource SystemControlForegroundBaseLowBrush}" />
        </Style>

        <Style Selector="TextBlock.log-level">
            <Setter Property="Margin" Value="{StaticResource ThicknessHorizontalS}" />
            <Setter Property="FontWeight" Value="{StaticResource FontWeightSemiBold}" />
        </Style>

        <Style Selector="TextBlock.log-level.level-debug">
            <Setter Property="Foreground" Value="Gray" />
        </Style>

        <Style Selector="TextBlock.log-level.level-info">
            <Setter Property="Foreground" Value="DodgerBlue" />
        </Style>

        <Style Selector="TextBlock.log-level.level-warning">
            <Setter Property="Foreground" Value="Orange" />
        </Style>

        <Style Selector="TextBlock.log-level.level-error">
            <Setter Property="Foreground" Value="Red" />
        </Style>
    </UserControl.Styles>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Page Header -->
        <Border Grid.Row="0" Classes="page-header">
            <Grid ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" Spacing="{StaticResource SpacingS}">
                    <TextBlock Text="Logs"
                               Classes="page-title" />
                    <TextBlock Text="View real-time logs from frpc process"
                               Classes="page-subtitle" />
                </StackPanel>

                <!-- Status Info -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="{StaticResource SpacingM}"
                            VerticalAlignment="Center">
                    <TextBlock Text="{Binding LogEntries.Count, StringFormat='{}{0} entries'}"
                               FontSize="{StaticResource FontSizeM}"
                               Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                               VerticalAlignment="Center" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Page Toolbar -->
        <Border Grid.Row="1" Classes="page-toolbar">
            <Grid ColumnDefinitions="*,Auto">
                <!-- Left: Filters -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="{StaticResource SpacingM}">
                    <TextBlock Text="Log Level:"
                               Classes="field-label" />
                    <ComboBox ItemsSource="{Binding LogLevels}"
                              SelectedItem="{Binding SelectedLogLevel}"
                              PlaceholderText="All Levels"
                              Classes="filter-box" />

                    <CheckBox IsChecked="{Binding IsFollowEnabled}"
                              Content="Auto-scroll"
                              Margin="{StaticResource ThicknessLeftL}"
                              VerticalAlignment="Center" />
                </StackPanel>

                <!-- Right: Action Buttons -->
                <StackPanel Grid.Column="1"
                            Orientation="Horizontal"
                            Spacing="{StaticResource SpacingS}">
                    <Button Command="{Binding RefreshCommand}"
                            Content="Refresh"
                            ToolTip.Tip="Reload logs from buffer"
                            IsEnabled="{Binding !IsClearing}" />
                    <Button Command="{Binding ClearLogsCommand}"
                            Content="Clear"
                            ToolTip.Tip="Clear all logs"
                            IsEnabled="{Binding !IsClearing}" />
                    <Button Command="{Binding ExportLogsCommand}"
                            Content="Export"
                            ToolTip.Tip="Export logs to file" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Page Content -->
        <Border Grid.Row="2" Classes="page-content">
            <Grid>
                <!-- Empty State -->
                <Border IsVisible="{Binding LogEntries.Count, Converter={x:Static ObjectConverters.IsNull}}"
                        Classes="empty-state"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">
                    <StackPanel Spacing="{StaticResource SpacingM}" HorizontalAlignment="Center">
                        <TextBlock Text="&#xF8D7;"
                                   FontFamily="{DynamicResource SymbolThemeFontFamily}"
                                   FontSize="48"
                                   Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="No logs available"
                                   FontSize="{StaticResource FontSizeXL}"
                                   FontWeight="{StaticResource FontWeightSemiBold}"
                                   Foreground="{DynamicResource SystemControlForegroundBaseHighBrush}"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="Logs will appear here once frpc is started"
                                   FontSize="{StaticResource FontSizeM}"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <!-- Log Viewer -->
                <ScrollViewer IsVisible="{Binding LogEntries.Count, Converter={x:Static ObjectConverters.IsNotNull}}"
                                HorizontalScrollBarVisibility="Disabled">
                    <ListBox ItemsSource="{Binding LogEntries}"
                             Classes="logViewer"
                             HorizontalAlignment="Stretch">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Spacing="0">
                                    <TextBlock Text="{Binding Timestamp, StringFormat='[{0:HH:mm:ss.fff}]'}"
                                               Classes="log-timestamp" />
                                    <TextBlock Text="["
                                               Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" />
                                    <TextBlock Text="{Binding Level, Converter={StaticResource LevelToLowerConverter}}"
                                               Classes="log-level" />
                                    <TextBlock Text="]"
                                               Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" />
                                    <TextBlock Text=" "
                                               Foreground="{DynamicResource SystemControlForegroundBaseLowBrush}" />
                                    <TextBlock Text="{Binding Message}"
                                               TextWrapping="NoWrap" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
